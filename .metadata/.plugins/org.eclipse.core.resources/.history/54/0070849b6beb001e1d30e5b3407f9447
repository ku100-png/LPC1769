/*
===============================================================================
 Name        : main.c
 Author      : $(author)
 Version     :
 Copyright   : $(copyright)
 Description : main definition
===============================================================================
*/

#ifdef __USE_CMSIS
#include "LPC17xx.h"
#endif

#include <cr_section_macros.h>

// TODO: insert other include files here
#include "type.h"
#include "uart.h"
// TODO: insert other definitions and declarations here

extern volatile uint32_t UART0Count;
extern volatile uint8_t UART0Buffer[BUFSIZE];
extern volatile uint32_t UART1Count;
extern volatile uint8_t UART1Buffer[BUFSIZE];

int main(void) {

    // TODO: insert code here
	/* SystemClockUpdate() updates the SystemFrequency variable */
	  SystemClockUpdate();

	  UARTInit(0, 9600);	/* baud rate setting */
	  UARTInit(1, 9600);	/* baud rate setting */

    // Force the counter to be placed into memory

    // Enter an infinite loop, just incrementing a counter
    while(1)
    {
    	if ( UART0Count != 0 )
		{
		  LPC_UART0->IER = IER_THRE | IER_RLS;			/* Disable RBR */
		  UARTSend( 0, (uint8_t *)UART0Buffer, UART0Count );
		  UART0Count = 0;
		  LPC_UART0->IER = IER_THRE | IER_RLS | IER_RBR;	/* Re-enable RBR */
		}
		if ( UART1Count != 0 )
		{
		  LPC_UART1->IER = IER_THRE | IER_RLS;			/* Disable RBR */
		  UARTSend( 1, (uint8_t *)UART1Buffer, UART1Count );
		  UART1Count = 0;
		  LPC_UART1->IER = IER_THRE | IER_RLS | IER_RBR;	/* Re-enable RBR */
		}
    }

    return 0 ;
}

